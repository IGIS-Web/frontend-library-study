# ğŸ¯ Tailwindì˜ ìºì‹± ê¸°ë²•

## ğŸ“Š ì „ì²´ í”Œë¡œìš° ìš”ì•½
(index.tsì—ì„œ)
- compile í•¨ìˆ˜ëŠ” **ë””ë ‰í‹°ë¸Œ ì²˜ë¦¬** -> **í›„ë³´ì ë¹Œë“œ** ì˜ 2ë‹¨ê³„ë¡œ êµ¬ì„±ë¨
- ë””ë ‰í‹°ë¸ŒëŠ” compile()ì˜ parseCss()ì—ì„œ í•œ ë²ˆë§Œ ì²˜ë¦¬ë¨
- ê·¸ í›„ í•« ë¦¬ë¡œë”©ì´ ë  ë•Œë§ˆë‹¤ build í•¨ìˆ˜ê°€ í˜¸ì¶œë˜ë©´ì„œ í›„ë³´ì ë¹Œë“œê°€ ì¼ì–´ë‚¨
- compile() ë‚´ë¶€ì— ìˆëŠ” compileAst()ëŠ” didChange ìºì‹±ìœ¼ë¡œ ì„±ëŠ¥ ìµœì í™”
- í›„ë³´ì ë¹Œë“œ ì‹œ optimizeAst()ë¡œ ìµœì¢… AST ìµœì í™” (ì¤‘ë³µ ì„ ì–¸, ë¯¸ì‚¬ìš© ê·œì¹™ ì œê±° ë“±)

```typescript
// ì´ˆê¸°í™” ë‹¨ê³„ (í•œ ë²ˆë§Œ)
export async function compile(css: string, opts: CompileOptions = {}) {
  // 1. CSS íŒŒì‹±
  let ast = CSS.parse(css)
  
  // 2. compileAst ì‹¤í–‰ - ë””ë ‰í‹°ë¸Œ ì²˜ë¦¬ ë° ë¹Œë“œ ì‹œìŠ¤í…œ ì„¤ì •
  // ì´ ì•ˆì— parseCss()ê°€ í¬í•¨ë˜ì–´ ìˆìŒ
  // build() í•¨ìˆ˜(ìµœì í™”ëœ AST ë°˜í™˜í•¨)ê°€ í¬í•¨ëœ ê°ì²´ ë°˜í™˜
  let api = await compileAst(ast, opts)

  // ìºì‹±ìš© ë³€ìˆ˜ë“¤
  let compiledAst = ast
  let compiledCss = css
  
  // 3. ë¹Œë“œ í•¨ìˆ˜ ë°˜í™˜
  return {
    // ëŸ°íƒ€ì„ ë‹¨ê³„ (ì—¬ëŸ¬ ë²ˆ í˜¸ì¶œë¨)
    build(candidates) {
      // 4. compileAstì˜ build() í˜¸ì¶œ - ì•ˆì—ì„œ optimizeAst() ì‹¤í–‰ë¨
      let newAst = api.build(candidates) // â— ì²«ë²ˆì§¸ ìºì‹±
      
      // 5. ASTê°€ ë³€ê²½ë˜ì§€ ì•Šì•˜ìœ¼ë©´ ìºì‹œëœ CSS ë°˜í™˜
      if (newAst === compiledAst) {
        return compiledCss  // â— ë‘ë²ˆì§¸ ìºì‹±
      }
      
      // 6. ìƒˆë¡œìš´ ASTê°€ ìƒì„±ë˜ì—ˆì„ ë•Œë§Œ CSS ì¬ìƒì„±
      compiledCss = toCss(newAst, !!opts.from)
      compiledAst = newAst
      
      return compiledCss
    }
  }
}
```


## ğŸ¯ `didChange` ìºì‹± (ì²«ë²ˆì§¸ ìºì‹±)

### 1. ë¬¸ì œ ìƒí™©
```ts
// ì´ˆê¸° 1íšŒ ì»´íŒŒì¼
const compiler = compile(baseCss, options)

// ğŸ”¥ íŒŒì¼ ë³€ê²½ë  ë•Œë§ˆë‹¤ build() í˜¸ì¶œ
// but ë§¤ë²ˆ build()ë¥¼ í˜¸ì¶œí•  ë•Œë§ˆë‹¤ optimizeAst()ë¥¼ ì‹¤í–‰í•˜ë©´ ë¹„íš¨ìœ¨ì 
compiler.build(['top-1']) // optimizeAst() ì‹¤í–‰
compiler.build(['top-1']) // ë˜ optimizeAst() ì‹¤í–‰? ğŸ¤”
compiler.build(['top-1']) // ë˜ë˜ optimizeAst() ì‹¤í–‰? ğŸ˜µ
```

### 2. compileAstì˜ ë‚´ë¶€ ìºì‹±
```ts
// compileAst í•¨ìˆ˜ ë‚´ë¶€ì˜ build ë©”ì†Œë“œ
return {
  build(newRawCandidates: string[]) {
    // ...existing code...
    
    let didChange = defaultDidChange  // ğŸ¯ ë³€ê²½ ê°ì§€ í”Œë˜ê·¸
    
    // ìƒˆë¡œìš´ í›„ë³´ìë“¤ ì²˜ë¦¬
    for (let candidate of newRawCandidates) {
      if (!designSystem.invalidCandidates.has(candidate)) {
        // ...existing code...
        allValidCandidates.add(candidate)
        didChange ||= allValidCandidates.size !== prevSize  // ğŸ“ ë³€ê²½ ê°ì§€!
      }
    }

    // ğŸš€ ë³€ê²½ì‚¬í•­ì´ ì—†ìœ¼ë©´ ìºì‹œëœ AST ë°˜í™˜
    if (!didChange) {
      compiled ??= optimizeAst(ast, designSystem, opts.polyfills)
      return compiled  // ìºì‹œ íˆíŠ¸!
    }

    // ë³€ê²½ì´ ìˆì„ ë•Œë§Œ ìƒˆë¡œ ì»´íŒŒì¼
    let newNodes = compileCandidates(allValidCandidates, designSystem, {
      onInvalidCandidate,
    }).astNodes
    
    // ...existing code...
    
    compiled = optimizeAst(ast, designSystem, opts.polyfills)
    return compiled
  }
}
```

### 3. **ì„±ëŠ¥ ìµœì í™” íš¨ê³¼**
- `optimizeAst()` ê±´ë„ˆë›°ê¸°(ì²«ë²ˆì§¸ ìºì‹±) - ê°€ì¥ ë¹„ìš©ì´ í° ìµœì í™” ë‹¨ê³„
- `toCss()` ê±´ë„ˆë›°ê¸°(ë‘ë²ˆì§¸ ìºì‹±) - ASTë¥¼ CSS ë¬¸ìì—´ë¡œ ë³€í™˜í•˜ëŠ” ë‹¨ê³„
- **ê°œë°œ ì¤‘ í•«ë¦¬ë¡œë”©**ì´ë‚˜ **ë™ì¼ ë¹Œë“œ ë°˜ë³µ** ì‹œ ì„±ëŠ¥ í–¥ìƒ