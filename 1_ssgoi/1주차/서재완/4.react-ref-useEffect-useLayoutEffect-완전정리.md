# React ref, useEffect, useLayoutEffect ì™„ì „ ì •ë¦¬

## ê°œìš”

Reactì—ì„œ ref callback, useEffect, useLayoutEffectì˜ ë™ì‘ ì›ë¦¬ì™€ ê°ê°ì˜ ìš©ë„, ì‹¤í–‰ íƒ€ì´ë°, ê·¸ë¦¬ê³  ì–¸ì œ ì–´ë–¤ ê²ƒì„ ì‚¬ìš©í•´ì•¼ í•˜ëŠ”ì§€ ì™„ì „ ì •ë¦¬í•©ë‹ˆë‹¤.

## 1. ref callback ì™„ì „ ì´í•´

### 1.1 ref callbackì´ë€?

ref callbackì€ Reactì—ì„œ DOM ìš”ì†Œì— ì ‘ê·¼í•˜ëŠ” ë°©ë²• ì¤‘ í•˜ë‚˜ì…ë‹ˆë‹¤.

```typescript
// ë°©ë²• 1: useRef ì‚¬ìš©
const elementRef = useRef<HTMLDivElement>(null);
<div ref={elementRef}>Content</div>

// ë°©ë²• 2: ref callback ì‚¬ìš© (ë” ê°•ë ¥í•¨)
const refCallback = (element: HTMLDivElement | null) => {
  if (element) {
    console.log('ìš”ì†Œê°€ ë§ˆìš´íŠ¸ë¨:', element);
    // cleanup í•¨ìˆ˜ ë°˜í™˜ ê°€ëŠ¥!
    return () => {
      console.log('ìš”ì†Œê°€ ì–¸ë§ˆìš´íŠ¸ë¨:', element);
    };
  }
};
<div ref={refCallback}>Content</div>
```

### 1.2 ref callbackì˜ ì‹¤í–‰ íƒ€ì´ë°

```typescript
function MyComponent() {
  console.log('1. ì»´í¬ë„ŒíŠ¸ ë Œë”ë§');

  const refCallback = (element: HTMLDivElement | null) => {
    if (element) {
      console.log('3. ref callback ì‹¤í–‰ (ë§ˆìš´íŠ¸)');
      return () => {
        console.log('6. ref callback cleanup (ì–¸ë§ˆìš´íŠ¸)');
      };
    } else {
      console.log('ì–¸ë§ˆìš´íŠ¸ ì‹œ nullë¡œ í˜¸ì¶œë¨');
    }
  };

  useLayoutEffect(() => {
    console.log('4. useLayoutEffect ì‹¤í–‰');
    return () => {
      console.log('7. useLayoutEffect cleanup');
    };
  }, []);

  useEffect(() => {
    console.log('5. useEffect ì‹¤í–‰');
    return () => {
      console.log('8. useEffect cleanup');
    };
  }, []);

  console.log('2. JSX ë°˜í™˜ ì§ì „');
  return <div ref={refCallback}>Content</div>;
}
```

**ì‹¤í–‰ ìˆœì„œ:**
```
ë§ˆìš´íŠ¸:
1. ì»´í¬ë„ŒíŠ¸ ë Œë”ë§
2. JSX ë°˜í™˜ ì§ì „
3. ref callback ì‹¤í–‰ (ë§ˆìš´íŠ¸)
4. useLayoutEffect ì‹¤í–‰
5. useEffect ì‹¤í–‰

ì–¸ë§ˆìš´íŠ¸:
6. ref callback cleanup (ì–¸ë§ˆìš´íŠ¸) â† ğŸ”¥ ê°€ì¥ ë¨¼ì €!
7. useLayoutEffect cleanup
8. useEffect cleanup
```

### 1.3 ref callback cleanupì´ í•˜ëŠ” ì¼

```typescript
const refCallback = (element: HTMLDivElement | null) => {
  if (element) {
    // ë§ˆìš´íŠ¸ ì‹œ ìˆ˜í–‰í•  ì‘ì—…
    console.log('DOM ìš”ì†Œ ë§ˆìš´íŠ¸:', element);
    
    // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
    const handleClick = () => console.log('clicked');
    element.addEventListener('click', handleClick);
    
    // DOM ì¡°ì‘
    element.style.opacity = '1';
    
    // cleanup í•¨ìˆ˜ ë°˜í™˜
    return () => {
      // ğŸ”¥ ì–¸ë§ˆìš´íŠ¸ ì‹œ ì •ë¦¬ ì‘ì—…
      console.log('DOM ìš”ì†Œ ì–¸ë§ˆìš´íŠ¸ ì¤€ë¹„:', element);
      
      // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±°
      element.removeEventListener('click', handleClick);
      
      // SSGOIì²˜ëŸ¼ ìš”ì†Œ ë³µì œë„ ê°€ëŠ¥!
      const clone = element.cloneNode(true);
      
      // DOM ì¡°ì‘ ì •ë¦¬
      element.style.opacity = '0';
    };
  }
};
```

**ref callback cleanupì˜ íŠ¹ì§•:**
- DOM ìš”ì†Œê°€ **ì™„ì „íˆ ì‚´ì•„ìˆëŠ” ìƒíƒœ**ì—ì„œ ì‹¤í–‰
- ë¶€ëª¨, í˜•ì œ ìš”ì†Œ ì •ë³´ ëª¨ë‘ ì ‘ê·¼ ê°€ëŠ¥
- ì™„ë²½í•œ DOM ì¡°ì‘ ë° ë³µì œ ê°€ëŠ¥
- Reactê°€ ì‹¤ì œë¡œ DOMì—ì„œ ì œê±°í•˜ê¸° ì§ì „ íƒ€ì´ë°

## 2. useEffect ì™„ì „ ì´í•´

### 2.1 useEffectì˜ íŠ¹ì§•

```typescript
function MyComponent() {
  useEffect(() => {
    console.log('useEffect ì‹¤í–‰');
    
    // ğŸ”¥ ë¹„ë™ê¸°ì ìœ¼ë¡œ ì‹¤í–‰ë¨ (ë¸Œë¼ìš°ì € í˜ì¸íŠ¸ í›„)
    // í™”ë©´ ë Œë”ë§ì„ ë¸”ë¡í•˜ì§€ ì•ŠìŒ
    
    return () => {
      console.log('useEffect cleanup');
    };
  }, []); // ì˜ì¡´ì„± ë°°ì—´

  return <div>Content</div>;
}
```

### 2.2 useEffectê°€ ì í•©í•œ ì‘ì—…ë“¤

#### 2.2.1 ë°ì´í„° í˜ì¹­ (Data Fetching)
```typescript
function UserProfile({ userId }: { userId: string }) {
  const [user, setUser] = useState(null);

  useEffect(() => {
    // âœ… ë°ì´í„° í˜ì¹­ì€ useEffectê°€ ìµœì 
    async function fetchUser() {
      const response = await fetch(`/api/users/${userId}`);
      const userData = await response.json();
      setUser(userData);
    }

    fetchUser();
  }, [userId]); // userId ë³€ê²½ ì‹œ ì¬ì‹¤í–‰

  return user ? <div>{user.name}</div> : <div>Loading...</div>;
}
```

#### 2.2.2 êµ¬ë… (Subscriptions)
```typescript
function ChatComponent() {
  const [messages, setMessages] = useState([]);

  useEffect(() => {
    // âœ… ì™¸ë¶€ ì‹œìŠ¤í…œ êµ¬ë…
    const unsubscribe = chatService.subscribe((newMessage) => {
      setMessages(prev => [...prev, newMessage]);
    });

    return () => {
      // âœ… êµ¬ë… í•´ì œ
      unsubscribe();
    };
  }, []);

  return (
    <div>
      {messages.map(msg => <div key={msg.id}>{msg.text}</div>)}
    </div>
  );
}
```

#### 2.2.3 íƒ€ì´ë¨¸ ê´€ë¦¬
```typescript
function Timer() {
  const [count, setCount] = useState(0);

  useEffect(() => {
    // âœ… íƒ€ì´ë¨¸ ì‹œì‘
    const interval = setInterval(() => {
      setCount(prev => prev + 1);
    }, 1000);

    return () => {
      // âœ… íƒ€ì´ë¨¸ ì •ë¦¬
      clearInterval(interval);
    };
  }, []);

  return <div>Count: {count}</div>;
}
```

#### 2.2.4 ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ (ì „ì—­)
```typescript
function KeyboardHandler() {
  useEffect(() => {
    // âœ… ì „ì—­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
    const handleKeyDown = (event: KeyboardEvent) => {
      if (event.key === 'Escape') {
        // ESC í‚¤ ì²˜ë¦¬
      }
    };

    window.addEventListener('keydown', handleKeyDown);

    return () => {
      // âœ… ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±°
      window.removeEventListener('keydown', handleKeyDown);
    };
  }, []);

  return <div>Press ESC to close</div>;
}
```

#### 2.2.5 ìƒíƒœ ë™ê¸°í™”
```typescript
function LocalStorageSync({ value }: { value: string }) {
  useEffect(() => {
    // âœ… ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì™€ ë™ê¸°í™”
    localStorage.setItem('myValue', value);
  }, [value]); // value ë³€ê²½ì‹œë§ˆë‹¤ ì €ì¥

  return <div>{value}</div>;
}
```

### 2.3 useEffect cleanup íŒ¨í„´

```typescript
function MyComponent() {
  useEffect(() => {
    // ì„¤ì • ì‘ì—…
    const controller = new AbortController();
    const eventSource = new EventSource('/api/events');
    const interval = setInterval(() => {}, 1000);

    // ì—¬ëŸ¬ ì •ë¦¬ ì‘ì—…
    return () => {
      controller.abort();      // API ìš”ì²­ ì·¨ì†Œ
      eventSource.close();     // EventSource ì¢…ë£Œ
      clearInterval(interval); // íƒ€ì´ë¨¸ ì •ë¦¬
    };
  }, []);
}
```

## 3. useLayoutEffect ì™„ì „ ì´í•´

### 3.1 useLayoutEffectì˜ íŠ¹ì§•

```typescript
function MyComponent() {
  useLayoutEffect(() => {
    console.log('useLayoutEffect ì‹¤í–‰');
    
    // ğŸ”¥ ë™ê¸°ì ìœ¼ë¡œ ì‹¤í–‰ë¨ (ë¸Œë¼ìš°ì € í˜ì¸íŠ¸ ì „)
    // í™”ë©´ ë Œë”ë§ì„ ë¸”ë¡í•  ìˆ˜ ìˆìŒ
    // DOM ë³€ê²½ì´ í™”ë©´ì— ë°˜ì˜ë˜ê¸° ì „ì— ì‹¤í–‰
    
    return () => {
      console.log('useLayoutEffect cleanup');
    };
  }, []);

  return <div>Content</div>;
}
```

### 3.2 useLayoutEffectë§Œ í•  ìˆ˜ ìˆëŠ” ì‘ì—…ë“¤

#### 3.2.1 DOM ì¸¡ì • ë° ì¦‰ì‹œ ìŠ¤íƒ€ì¼ ì ìš©
```typescript
function AutoSizeTextarea() {
  const [text, setText] = useState('');
  const textareaRef = useRef<HTMLTextAreaElement>(null);

  useLayoutEffect(() => {
    // âœ… DOM ì¸¡ì • í›„ ì¦‰ì‹œ ìŠ¤íƒ€ì¼ ì ìš© (ê¹œë¹¡ì„ ë°©ì§€)
    if (textareaRef.current) {
      textareaRef.current.style.height = 'auto';
      textareaRef.current.style.height = textareaRef.current.scrollHeight + 'px';
    }
  }, [text]); // text ë³€ê²½ì‹œë§ˆë‹¤ ë†’ì´ ì¡°ì •

  return (
    <textarea
      ref={textareaRef}
      value={text}
      onChange={(e) => setText(e.target.value)}
      style={{ resize: 'none', overflow: 'hidden' }}
    />
  );
}
```

#### 3.2.2 ìŠ¤í¬ë¡¤ ìœ„ì¹˜ ë³µì›
```typescript
function ScrollRestoration() {
  const [items, setItems] = useState([]);
  const listRef = useRef<HTMLDivElement>(null);
  const savedScrollTop = useRef(0);

  useLayoutEffect(() => {
    // âœ… ìƒˆ ì•„ì´í…œ ë¡œë“œ í›„ ìŠ¤í¬ë¡¤ ìœ„ì¹˜ ì¦‰ì‹œ ë³µì›
    if (listRef.current) {
      listRef.current.scrollTop = savedScrollTop.current;
    }
  }, [items]);

  const handleScroll = () => {
    if (listRef.current) {
      savedScrollTop.current = listRef.current.scrollTop;
    }
  };

  return (
    <div ref={listRef} onScroll={handleScroll}>
      {items.map(item => <div key={item.id}>{item.name}</div>)}
    </div>
  );
}
```

#### 3.2.3 ì• ë‹ˆë©”ì´ì…˜ ì‹œì‘ ì „ ìŠ¤íƒ€ì¼ ì„¤ì •
```typescript
function AnimatedModal({ isOpen }: { isOpen: boolean }) {
  const modalRef = useRef<HTMLDivElement>(null);

  useLayoutEffect(() => {
    if (modalRef.current && isOpen) {
      // âœ… ì• ë‹ˆë©”ì´ì…˜ ì‹œì‘ ì „ ì´ˆê¸° ìƒíƒœ ì„¤ì • (ê¹œë¹¡ì„ ë°©ì§€)
      modalRef.current.style.opacity = '0';
      modalRef.current.style.transform = 'scale(0.8)';
      
      // ë‹¤ìŒ í”„ë ˆì„ì—ì„œ ì• ë‹ˆë©”ì´ì…˜ ì‹œì‘
      requestAnimationFrame(() => {
        if (modalRef.current) {
          modalRef.current.style.transition = 'all 0.3s ease';
          modalRef.current.style.opacity = '1';
          modalRef.current.style.transform = 'scale(1)';
        }
      });
    }
  }, [isOpen]);

  if (!isOpen) return null;

  return (
    <div ref={modalRef} className="modal">
      Modal Content
    </div>
  );
}
```

#### 3.2.4 Tooltip ìœ„ì¹˜ ê³„ì‚°
```typescript
function Tooltip({ targetRef, children }: {
  targetRef: RefObject<HTMLElement>;
  children: ReactNode;
}) {
  const tooltipRef = useRef<HTMLDivElement>(null);
  const [position, setPosition] = useState({ top: 0, left: 0 });

  useLayoutEffect(() => {
    // âœ… DOM ì¸¡ì • í›„ ì¦‰ì‹œ ìœ„ì¹˜ ê³„ì‚° (ê¹œë¹¡ì„ ë°©ì§€)
    if (targetRef.current && tooltipRef.current) {
      const targetRect = targetRef.current.getBoundingClientRect();
      const tooltipRect = tooltipRef.current.getBoundingClientRect();
      
      const top = targetRect.bottom + 8;
      const left = targetRect.left + (targetRect.width - tooltipRect.width) / 2;
      
      setPosition({ top, left });
    }
  });

  return (
    <div
      ref={tooltipRef}
      style={{
        position: 'fixed',
        top: position.top,
        left: position.left,
        zIndex: 1000,
      }}
    >
      {children}
    </div>
  );
}
```

#### 3.2.5 Virtual Scrolling êµ¬í˜„
```typescript
function VirtualList({ items }: { items: any[] }) {
  const containerRef = useRef<HTMLDivElement>(null);
  const [visibleRange, setVisibleRange] = useState({ start: 0, end: 10 });

  useLayoutEffect(() => {
    // âœ… ìŠ¤í¬ë¡¤ í›„ ì¦‰ì‹œ ê°€ì‹œ ë²”ìœ„ ê³„ì‚°
    const container = containerRef.current;
    if (!container) return;

    const handleScroll = () => {
      const scrollTop = container.scrollTop;
      const itemHeight = 50; // ê³ ì • ë†’ì´
      const containerHeight = container.clientHeight;
      
      const start = Math.floor(scrollTop / itemHeight);
      const end = Math.min(start + Math.ceil(containerHeight / itemHeight) + 1, items.length);
      
      setVisibleRange({ start, end });
    };

    container.addEventListener('scroll', handleScroll);
    handleScroll(); // ì´ˆê¸° ê³„ì‚°

    return () => container.removeEventListener('scroll', handleScroll);
  }, [items]);

  const visibleItems = items.slice(visibleRange.start, visibleRange.end);

  return (
    <div ref={containerRef} style={{ height: 400, overflow: 'auto' }}>
      <div style={{ height: items.length * 50 }}>
        <div style={{ transform: `translateY(${visibleRange.start * 50}px)` }}>
          {visibleItems.map((item, index) => (
            <div key={visibleRange.start + index} style={{ height: 50 }}>
              {item.name}
            </div>
          ))}
        </div>
      </div>
    </div>
  );
}
```

### 3.3 useLayoutEffect ì£¼ì˜ì‚¬í•­

```typescript
function BadExample() {
  const [data, setData] = useState(null);

  useLayoutEffect(() => {
    // âŒ ë¹„ë™ê¸° ì‘ì—…ì„ useLayoutEffectì—ì„œ í•˜ë©´ ì•ˆë¨!
    // ë¸Œë¼ìš°ì € ë Œë”ë§ì„ ë¸”ë¡í•¨
    fetch('/api/data')
      .then(response => response.json())
      .then(setData);
  }, []);

  return <div>{data?.name}</div>;
}

function GoodExample() {
  const [data, setData] = useState(null);

  useEffect(() => {
    // âœ… ë¹„ë™ê¸° ì‘ì—…ì€ useEffectì—ì„œ
    fetch('/api/data')
      .then(response => response.json())
      .then(setData);
  }, []);

  return <div>{data?.name}</div>;
}
```

## 4. ì–¸ì œ ë¬´ì—‡ì„ ì‚¬ìš©í• ê¹Œ?

### 4.1 ì„ íƒ ê¸°ì¤€

| ì‘ì—… ìœ í˜• | ref callback | useEffect | useLayoutEffect |
|----------|-------------|-----------|-----------------|
| DOM ìš”ì†Œ ì ‘ê·¼/ì¡°ì‘ | âœ… ìµœì  | âš ï¸ ì œí•œì  | âœ… ê°€ëŠ¥ |
| ìš”ì†Œ ìƒì„±/ì œê±° ê°ì§€ | âœ… ì™„ë²½ | âŒ ë¶ˆê°€ | âŒ ë¶ˆê°€ |
| ë°ì´í„° í˜ì¹­ | âŒ ë¶€ì ì ˆ | âœ… ìµœì  | âŒ ë¶€ì ì ˆ |
| DOM ì¸¡ì • | âœ… ê°€ëŠ¥ | âš ï¸ ê¹œë¹¡ì„ | âœ… ì™„ë²½ |
| ì• ë‹ˆë©”ì´ì…˜ ì¤€ë¹„ | âœ… ì™„ë²½ | âš ï¸ ê¹œë¹¡ì„ | âœ… ì™„ë²½ |
| ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ | âœ… ìš”ì†Œë³„ | âœ… ì „ì—­ | âœ… ì „ì—­ |
| êµ¬ë…/íƒ€ì´ë¨¸ | âŒ ë¶€ì ì ˆ | âœ… ìµœì  | âš ï¸ ì„±ëŠ¥ ë¬¸ì œ |

### 4.2 ì‹¤ì œ ì‚¬ìš© íŒ¨í„´

#### 4.2.1 SSGOI ê°™ì€ ì• ë‹ˆë©”ì´ì…˜ ë¼ì´ë¸ŒëŸ¬ë¦¬
```typescript
// âœ… ref callback ì‚¬ìš© - ì™„ë²½í•œ íƒ€ì´ë°
const refCallback = (element: HTMLElement | null) => {
  if (element) {
    // ì…ì¥ ì• ë‹ˆë©”ì´ì…˜ ì¤€ë¹„
    runEntranceAnimation(element);
    
    return () => {
      // ì™„ë²½í•œ ì‹œì ì— ìš”ì†Œ ë³µì œ ë° í‡´ì¥ ì• ë‹ˆë©”ì´ì…˜
      const clone = element.cloneNode(true);
      runExitAnimation(clone);
    };
  }
};
```

#### 4.2.2 ë°˜ì‘í˜• ì»´í¬ë„ŒíŠ¸
```typescript
function ResponsiveComponent() {
  const elementRef = useRef<HTMLDivElement>(null);
  const [isMobile, setIsMobile] = useState(false);

  useLayoutEffect(() => {
    // âœ… í™”ë©´ í¬ê¸°ì— ë”°ë¥¸ ì¦‰ì‹œ ìŠ¤íƒ€ì¼ ì ìš©
    const checkMobile = () => {
      if (elementRef.current) {
        const width = elementRef.current.offsetWidth;
        setIsMobile(width < 768);
      }
    };

    checkMobile();
    window.addEventListener('resize', checkMobile);
    return () => window.removeEventListener('resize', checkMobile);
  });

  return (
    <div ref={elementRef}>
      {isMobile ? <MobileLayout /> : <DesktopLayout />}
    </div>
  );
}
```

#### 4.2.3 ë°ì´í„° ë™ê¸°í™” ì»´í¬ë„ŒíŠ¸
```typescript
function DataSync({ userId }: { userId: string }) {
  const [userData, setUserData] = useState(null);

  useEffect(() => {
    // âœ… ë°ì´í„° í˜ì¹­ì€ useEffect
    let cancelled = false;

    async function fetchUser() {
      try {
        const response = await fetch(`/api/users/${userId}`);
        const data = await response.json();
        if (!cancelled) {
          setUserData(data);
        }
      } catch (error) {
        if (!cancelled) {
          console.error('Failed to fetch user:', error);
        }
      }
    }

    fetchUser();

    return () => {
      cancelled = true; // cleanupìœ¼ë¡œ ì·¨ì†Œ ì²˜ë¦¬
    };
  }, [userId]);

  return userData ? <UserProfile data={userData} /> : <Loading />;
}
```

## 5. ê³ ê¸‰ íŒ¨í„´ê³¼ ì¡°í•©

### 5.1 ref callback + useLayoutEffect ì¡°í•©
```typescript
function MeasuredComponent() {
  const [dimensions, setDimensions] = useState({ width: 0, height: 0 });
  const elementRef = useRef<HTMLDivElement>(null);

  const refCallback = (element: HTMLDivElement | null) => {
    elementRef.current = element;
    if (element) {
      // ì´ˆê¸° ì¸¡ì •
      const rect = element.getBoundingClientRect();
      setDimensions({ width: rect.width, height: rect.height });
    }
  };

  useLayoutEffect(() => {
    // í¬ê¸° ë³€ê²½ ê°ì§€
    if (!elementRef.current) return;

    const resizeObserver = new ResizeObserver(entries => {
      for (const entry of entries) {
        setDimensions({
          width: entry.contentRect.width,
          height: entry.contentRect.height,
        });
      }
    });

    resizeObserver.observe(elementRef.current);
    return () => resizeObserver.disconnect();
  });

  return (
    <div ref={refCallback}>
      <p>Width: {dimensions.width}px</p>
      <p>Height: {dimensions.height}px</p>
    </div>
  );
}
```

### 5.2 useEffect + useLayoutEffect ì¡°í•©
```typescript
function OptimizedComponent({ data }: { data: any[] }) {
  const [processedData, setProcessedData] = useState([]);
  const listRef = useRef<HTMLDivElement>(null);

  useEffect(() => {
    // âœ… ë¬´ê±°ìš´ ë°ì´í„° ì²˜ë¦¬ëŠ” useEffect (ë¹„ë™ê¸°)
    const processed = data.map(item => ({
      ...item,
      computed: expensiveComputation(item),
    }));
    setProcessedData(processed);
  }, [data]);

  useLayoutEffect(() => {
    // âœ… DOM ì¡°ì‘ì€ useLayoutEffect (ë™ê¸°)
    if (listRef.current && processedData.length > 0) {
      // ìŠ¤í¬ë¡¤ ìœ„ì¹˜ ì¡°ì • ë“±
      listRef.current.scrollTop = 0;
    }
  }, [processedData]);

  return (
    <div ref={listRef}>
      {processedData.map(item => (
        <div key={item.id}>{item.name}</div>
      ))}
    </div>
  );
}
```

## 6. ì„±ëŠ¥ ìµœì í™” íŒ

### 6.1 ref callback ìµœì í™”
```typescript
function OptimizedRef() {
  // âœ… useCallbackìœ¼ë¡œ ref callback ë©”ëª¨ì´ì œì´ì…˜
  const refCallback = useCallback((element: HTMLDivElement | null) => {
    if (element) {
      // ì´ˆê¸°í™” ë¡œì§
      return () => {
        // ì •ë¦¬ ë¡œì§
      };
    }
  }, []); // ì˜ì¡´ì„± ì—†ìŒ

  return <div ref={refCallback}>Content</div>;
}
```

### 6.2 useLayoutEffect ì„±ëŠ¥ ì£¼ì˜
```typescript
function PerformanceAware() {
  const [trigger, setTrigger] = useState(0);

  useLayoutEffect(() => {
    // âŒ ë§¤ë²ˆ ì‹¤í–‰ë˜ë©´ ì„±ëŠ¥ ë¬¸ì œ
    console.log('ë§¤ë²ˆ ì‹¤í–‰ë¨');
  }); // ì˜ì¡´ì„± ë°°ì—´ ì—†ìŒ

  useLayoutEffect(() => {
    // âœ… í•„ìš”í•  ë•Œë§Œ ì‹¤í–‰
    console.log('trigger ë³€ê²½ì‹œì—ë§Œ ì‹¤í–‰');
  }, [trigger]); // ì˜ì¡´ì„± ë°°ì—´ ìˆìŒ

  return <button onClick={() => setTrigger(prev => prev + 1)}>Trigger</button>;
}
```

## 7. ê²°ë¡ 

### 7.1 ê°ê°ì˜ ìµœì  ìš©ë„

**ref callback:**
- DOM ìš”ì†Œì˜ ìƒì„±/ì œê±° ê°ì§€
- ì™„ë²½í•œ íƒ€ì´ë°ì˜ DOM ì¡°ì‘
- ì• ë‹ˆë©”ì´ì…˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ êµ¬í˜„
- ìš”ì†Œë³„ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ê´€ë¦¬

**useEffect:**
- ë°ì´í„° í˜ì¹­
- ì™¸ë¶€ ì‹œìŠ¤í…œ êµ¬ë…
- íƒ€ì´ë¨¸ ê´€ë¦¬
- ì „ì—­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
- ìƒíƒœ ë™ê¸°í™”

**useLayoutEffect:**
- DOM ì¸¡ì • ë° ì¦‰ì‹œ ìŠ¤íƒ€ì¼ ì ìš©
- ì• ë‹ˆë©”ì´ì…˜ ì´ˆê¸° ìƒíƒœ ì„¤ì •
- ìŠ¤í¬ë¡¤ ìœ„ì¹˜ ì¡°ì‘
- ê¹œë¹¡ì„ ë°©ì§€ê°€ ì¤‘ìš”í•œ UI ì¡°ì‘

### 7.2 SSGOIê°€ ref callbackì„ ì„ íƒí•œ ì´ìœ 

1. **ì™„ë²½í•œ íƒ€ì´ë°**: DOM ìš”ì†Œê°€ ì™„ì „íˆ ì‚´ì•„ìˆëŠ” ë§ˆì§€ë§‰ ìˆœê°„
2. **ì™„ì „í•œ ì ‘ê·¼**: ë¶€ëª¨, í˜•ì œ ìš”ì†Œ ì •ë³´ ëª¨ë‘ ì ‘ê·¼ ê°€ëŠ¥
3. **ìì—°ìŠ¤ëŸ¬ìš´ ì •ë¦¬**: Reactì˜ ì •ë¦¬ ê³¼ì •ê³¼ ì™„ë²½íˆ ì¡°í™”
4. **ì„±ëŠ¥ ìµœì í™”**: í•„ìš”í•œ ìˆœê°„ì—ë§Œ ì‹¤í–‰

**í•µì‹¬**: ê° Hookì˜ íŠ¹ì„±ì„ ì •í™•íˆ ì´í•´í•˜ê³  ìš©ë„ì— ë§ê²Œ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ React ê°œë°œì˜ í•µì‹¬ì…ë‹ˆë‹¤.